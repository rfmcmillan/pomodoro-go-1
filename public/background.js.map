{"version":3,"sources":["webpack://pomodoro_go/./client/storage.js","webpack://pomodoro_go/webpack/bootstrap","webpack://pomodoro_go/webpack/runtime/define property getters","webpack://pomodoro_go/webpack/runtime/hasOwnProperty shorthand","webpack://pomodoro_go/webpack/runtime/make namespace object","webpack://pomodoro_go/./client/background.js"],"names":["setStoredBlackList","blackList","vals","Promise","resolve","chrome","storage","local","set","getStoredBlackList","get","res","setStoredIsRunning","isRunning","getStoredIsRunning","setStoredTimer","timer","getStoredTimer","setStoredDisplayTime","displayTime","getStoredDisplayTime","setStoredAuth","auth","getStoredAuth","tabs","runtime","alarms","scripting","msToHMS","ms","seconds","hours","parseInt","minutes","action","onClicked","addListener","tab","create","url","background","active","currentTab","sessionTime","appStarted","getCurrentTab","queryOptions","currentWindow","query","init","console","log","sync","clear","clearAll","listenForAlarm","listenToExternalMessages","listenToStorage","listenToTabs","listenForBlockedSite","listenForDashboardRedirect","error","createAlarm","when","Date","now","alarmCreated","resetStorage","timerOn","currentSession","sessionComplete","user","email","onMessageExternal","message","sender","sendResponse","sites","blockedSites","forEach","site","push","siteUrl","blocked","currUser","results","doesItExist","find","toggleSite","update","filter","each","onChanged","changes","namespace","key","oldValue","newValue","Object","entries","JSON","stringify","onUpdated","tabId","changeInfo","reduce","previous","current","lastAccessed","pendingUrl","startsWith","hostname","URL","userAttempt","Array","isArray","domain","includes","options","method","headers","body","fetch","err","async","then","process","onAlarm","alarm","name","notifications","undefined","type","title","iconUrl","requireInteraction","silent","lastError","onButtonClicked","notificationId","buttonIdx","id","periodInMinutes","time"],"mappings":"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","file":"background.js","sourcesContent":["export function setStoredBlackList(blackList) {\n  const vals = {\n    blackList,\n  };\n  return new Promise((resolve) => {\n    chrome.storage.local.set(vals, () => {\n      resolve();\n    });\n  });\n}\n\nexport function getStoredBlackList() {\n  return new Promise((resolve) => {\n    chrome.storage.local.get(['blackList'], (res) => {\n      resolve(res.blackList);\n    });\n  });\n}\n\nexport function setStoredIsRunning(isRunning) {\n  chrome.storage.local.set({ isRunning });\n}\n\nexport function getStoredIsRunning() {\n  chrome.storage.local.get(['isRunning'], (res) => {\n    resolve(res.isRunning);\n  });\n}\n\nexport function setStoredTimer(timer) {\n  const vals = {\n    timer,\n  };\n  return new Promise((resolve) => {\n    chrome.storage.local.set(vals, () => {\n      resolve();\n    });\n  });\n}\n\nexport function getStoredTimer() {\n  chrome.storage.local.get(['timer'], (res) => {\n    resolve(res.timer);\n  });\n}\n\nexport function setStoredDisplayTime(displayTime) {\n  const vals = {\n    displayTime,\n  };\n  return new Promise((resolve) => {\n    chrome.storage.local.set(vals, () => {\n      resolve();\n    });\n  });\n}\n\nexport function getStoredDisplayTime() {\n  chrome.storage.local.get(['displayTime'], (res) => {\n    resolve(res.displayTime);\n  });\n}\n\nexport function setStoredAuth(auth) {\n  const vals = {\n    auth,\n  };\n  return new Promise((resolve) => {\n    chrome.storage.local.set(vals, () => {\n      resolve();\n    });\n  });\n}\n\nexport function getStoredAuth() {\n  return new Promise((resolve) => {\n    chrome.storage.local.get(['auth'], (res) => {\n      resolve(res.auth);\n    });\n  });\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","'use strict';\nconst { storage, tabs, runtime, alarms, scripting } = chrome;\nimport { getStoredBlackList } from './storage';\nimport {\n  setStoredIsRunning,\n  setStoredTimer,\n  setStoredDisplayTime,\n} from './storage';\n\nconst msToHMS = (ms) => {\n  let seconds = ms / 1000;\n\n  let hours = parseInt(seconds / 3600);\n  seconds = seconds % 3600;\n\n  let minutes = parseInt(seconds / 60);\n  seconds = seconds % 60;\n\n  hours = hours < 10 ? '0' + hours : hours;\n  minutes = minutes < 10 ? '0' + minutes : minutes;\n  seconds = seconds < 10 ? (seconds >= 0 ? '0' + seconds : '00') : seconds;\n\n  return hours + ':' + minutes + ':' + seconds;\n};\n\nchrome.action.onClicked.addListener((tab) => {\n  chrome.tabs.create({\n    url: 'index.html',\n  });\n});\n\nconst background = {\n  active: false,\n  currentTab: null,\n  sessionTime: 0,\n  appStarted: false,\n  getCurrentTab: async function () {\n    let queryOptions = { active: true, currentWindow: true };\n    let [tab] = await chrome.tabs.query(queryOptions);\n    return tab;\n  },\n  init: async function () {\n    try {\n      if (!this.active) {\n        console.log('running app!');\n        storage.sync.clear();\n        setStoredIsRunning(false);\n        setStoredTimer(null);\n        alarms.clearAll(() => {\n          console.log('alarms are cleared');\n        });\n\n        this.listenForAlarm();\n        this.listenToExternalMessages();\n        this.listenToStorage();\n        this.listenToTabs();\n        this.listenForBlockedSite();\n        this.listenForDashboardRedirect();\n        this.active = true;\n      }\n      this.currentTab = await this.getCurrentTab();\n    } catch (error) {\n      console.log('issue with start up in background js', error);\n    }\n  },\n  createAlarm: function () {\n    chrome.alarms.create('timer', {\n      when: Date.now() + this.sessionTime,\n    });\n    this.alarmCreated = true;\n    chrome.storage.sync.set({ alarmCreated: true });\n  },\n  resetStorage() {\n    storage.local.set({\n      sessionTime: 0,\n      timerOn: false,\n      currentSession: {},\n      alarmCreated: false,\n      sessionComplete: false,\n      user: {},\n      email: '',\n    });\n  },\n\n  listenToExternalMessages: function () {\n    return runtime.onMessageExternal.addListener(\n      async (message, sender, sendResponse) => {\n        try {\n          if (message.message === 'create-timer') {\n            this.sessionTime = message.sessionTime;\n            this.createAlarm();\n          }\n          if (message.message === 'continue-alarm') {\n            console.log('you want me to start an alarm?');\n            alarms.clearAll(() => {\n              console.log('alarms are cleared again');\n              alarms.create('timer', {\n                when: Date.now() + message.sessionTime,\n              });\n              console.log('new alarm created');\n            });\n          }\n          if (message.message === 'timer-done') {\n            alarms.create('timer', { when: Date.now() });\n          }\n          if (message.message === 'set-blocked-sites') {\n            console.log('set-blocked-sites message received');\n            const sites = [];\n            message.blockedSites.forEach((site) => {\n              sites.push(site.siteUrl);\n            });\n            chrome.storage.sync.set(\n              { blocked: sites, currUser: message.currUser },\n              () => {\n                console.log('sites are blocked in chrome');\n              }\n            );\n            console.log('blocked sites', message);\n            chrome.storage.sync.get(null, (results) => {\n              console.log('current chrome storage', results);\n            });\n          }\n          if (message.message === 'toggle-block-or-not') {\n            chrome.storage.sync.get(['blocked'], (results) => {\n              const doesItExist = results.blocked.find((url) => {\n                return url === message.toggleSite;\n              });\n              if (doesItExist) {\n                const update = results.blocked.filter((each) => {\n                  return each !== message.toggleSite;\n                });\n                chrome.storage.sync.set({ blocked: update });\n              } else {\n                results.blocked.push(message.toggleSite);\n                chrome.storage.sync.set({ blocked: results.blocked });\n              }\n            });\n          }\n        } catch (error) {\n          console.log(error);\n        }\n      }\n    );\n  },\n  listenToStorage: function () {\n    return storage.onChanged.addListener(async function (changes, namespace) {\n      // logging out the changes in storage\n      // THIS CODE IS FOR DEV PURPOSES\n      // YOU WILL HAVE ALOT OF LOGS IN CONSOLE\n      for (let [key, { oldValue, newValue }] of Object.entries(changes)) {\n        console.log(\n          `Storage key \"${key}\" in namespace \"${namespace}\" changed.`,\n          `Old value was \"${JSON.stringify(\n            oldValue\n          )}\", new value is \"${JSON.stringify(newValue)}\".`\n        );\n      }\n    });\n  },\n  listenToTabs: function () {\n    return tabs.onUpdated.addListener(function (tabId, changeInfo) {\n      console.log('listening to tabs, tabID', tabId);\n      chrome.tabs.query({ active: false }, (tabs) => {\n        let tab = tabs.reduce((previous, current) => {\n          return previous.lastAccessed > current.lastAccessed\n            ? previous\n            : current;\n        });\n      });\n      chrome.storage.sync.get(null, (results) => {\n        const {\n          currentSession,\n          alarmCreated,\n          sessionComplete,\n          sessionTime,\n          timerOn,\n        } = results;\n        const url = changeInfo.pendingUrl || changeInfo.url;\n        if (!url || !url.startsWith('http')) {\n          return;\n        }\n        const hostname = new URL(url).hostname;\n\n        storage.sync.set({ userAttempt: hostname });\n\n        storage.sync.get(['blocked', 'currUser'], async function (sync) {\n          const { blocked, currUser } = sync;\n          if (\n            Array.isArray(blocked) &&\n            blocked.find((domain) => {\n              return domain.includes(hostname);\n            })\n          ) {\n            const options = {\n              method: 'post',\n              headers: {\n                'Content-type':\n                  'application/x-www-form-urlencoded; charset=UTF-8',\n              },\n              body: `userAttempted=${hostname}&userId=${currUser}`,\n            };\n\n            try {\n              await fetch(\n                'https://pomodoro-go-1.herokuapp.com/api/blocks',\n                options\n              );\n            } catch (err) {\n              console.error('Request failed', err);\n            }\n\n            chrome.tabs.update(tabId, {\n              url: 'https://pomodoro-go-1.herokuapp.com/uhoh',\n            }); // hard-code it to production url atm instead of 'http://localhost:8080/uhoh'\n          }\n        });\n      });\n    });\n  },\n\n  listenForBlockedSite: function () {\n    return chrome.tabs.onUpdated.addListener(function async(tabId, changeInfo) {\n      if (changeInfo.url) {\n        // const hostname = new URL(url).hostname;\n        // console.log(hostname);\n        getStoredBlackList().then((blackList) => {\n          if (blackList) {\n            if (blackList.includes(changeInfo.url)) {\n              chrome.tabs.update(tabId, {\n                url: `${process.env.API_URL}/uhoh`,\n              });\n            }\n          }\n        });\n      }\n    });\n  },\n\n  listenForAlarm: function () {\n    return chrome.alarms.onAlarm.addListener(function (alarm) {\n      if (alarm.name === 'startTimer') {\n        chrome.notifications.create(\n          undefined,\n          {\n            type: 'basic',\n            title: 'Your focus session is complete!',\n            message: 'Nice job! You deserve a break!',\n            iconUrl: 'logo-pomo.png',\n            requireInteraction: true,\n            silent: false,\n          },\n          () => {\n            console.log('last error: ', chrome.runtime.lastError);\n          }\n        );\n        chrome.storage.local.set({\n          alarmCreated: false,\n          currentSession: {},\n          timerOn: false,\n          sessionTime: 0,\n          sessionComplete: true,\n        });\n      }\n    });\n  },\n  listenForDashboardRedirect: function () {\n    // THIS BUTTON WORKS BUT DASHBOARD DOES NOT LOAD\n    return chrome.notifications.onButtonClicked.addListener(\n      async (notificationId, buttonIdx) => {\n        // redirects to dashboard after session is complete\n        let tab = await this.getCurrentTab();\n        chrome.tabs.update(tab.id, {\n          url: 'https://pomodoro-go-1.herokuapp.com/dashboard',\n        });\n      }\n    );\n  },\n};\n\nbackground.init();\n\n//Timer in Background\nchrome.alarms.create('oneSecond', {\n  periodInMinutes: 1 / 60,\n});\n\nchrome.alarms.onAlarm.addListener((alarm) => {\n  if (alarm.name === 'oneSecond') {\n    chrome.storage.local.get(['isRunning', 'timer'], (res) => {\n      console.log('res.isRunning:', res.isRunning);\n      const time = res.timer ?? 0;\n\n      if (time === 0) {\n        setStoredIsRunning(false);\n        return;\n      }\n      if (!res.isRunning) {\n        return;\n      }\n      const displayTime = msToHMS(time - 1000);\n      setStoredDisplayTime(displayTime);\n      setStoredTimer(time - 1000);\n    });\n  }\n});\n"],"sourceRoot":""}